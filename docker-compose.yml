# This is the docker-compose spec for a production deployment of the application
# This file will deploy Nginx which serves static files generated by CRA, the Express backend and MongoDB
version: '3'

services:
  # The front-end nginx server. This serves built react files and proxies requests to the backend API.
  piranha-client:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    container_name: piranha-client
    ports:
      - "8080:80"
    networks:
      - piranha-network
    depends_on:
      - piranha-server
  # The Express Backend
  piranha-server:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: piranha-server
    networks:
      - piranha-network
    depends_on:
      - piranha-mongo
    env_file:
      - ./backend/.env
  # The MongoDB server
  piranha-mongo:
    build:
      context: ./mongo
      dockerfile: Dockerfile
    container_name: piranha-mongo
    networks:
      - piranha-network
    volumes:
      - piranha-data:/data:rw
  
# Declare a Docker network to be used for the application
networks:
  piranha-network:
    driver: bridge

# Declare volumes used
volumes:
  piranha-data:
    driver: local
